- [三种类型的SSH端口转发：](#三种类型的ssh端口转发)
  - [本地端口转发。](#本地端口转发)
    - [其中"-L"选项表示本地端口转发，其工作方式为：](#其中-l选项表示本地端口转发其工作方式为)
    - [再来解释下"-g"选项](#再来解释下-g选项)
    - [再来分析下转发端口通信的过程。](#再来分析下转发端口通信的过程)
    - [后端运行 -f](#后端运行--f)
    - [不要执行命令 -N](#不要执行命令--n)
  - [远程端口转发。](#远程端口转发)
  - [动态端口转发。](#动态端口转发)
# 三种类型的SSH端口转发：



## 本地端口转发。
假如host3和host1、host2都同互相通信，但是host1和host2之间不能通信，如何从host1连接上host2？


![本地端口转发](./%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91.png)  

    ssh -L [local_bind_addr:]local_port:remote:remote_port middle_host

举例：

    [root@xuexi ~]# ssh -g -L 2222:host2:80 host3
说明：  
### 其中"-L"选项表示本地端口转发，其工作方式为：
1. 在本地指定一个由ssh监听的转发端口(2222)，
2. 将远程主机的端口(host2:80)映射为本地端口(2222)，
3. 当有主机连接本地映射端口(2222)时，
4. 本地ssh就将此端口的数据包转发给中间主机(host3)，然后host3再与远程主机的端口(host2:80)通信。

这样就可以通过访问host1的2222端口来达到访问host2:80的目的了。
### 再来解释下"-g"选项
1. 指定该选项表示允许外界主机连接本地转发端口(2222)，  
2. 如果不指定"-g"，则host4将无法通过访问host1:2222达到访问host2:80的目的。  
3. 甚至，host1自身也不能使用172.16.10.5:2222，  
4. 而只能使用localhost:2222或127.0.0.1:2222这样的方式达到访问host2:80的目的，  
5. 之所以如此，是因为本地转发端口默认绑定在回环地址上。

一般来说，使用转发端口，都建议同时使用"-g"选项，否则将只有自身能访问转发端口。

### 再来分析下转发端口通信的过程。 
![本地端口转发通讯](./%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%80%9A%E8%AE%AF.png)

### 后端运行 -f 
应该在ssh命令行上加上"-f"选项让ssh在本机host1上以后台方式提供端口转发功能，而不是跳到host3上来提供端口转发功能  
### 不要执行命令 -N
结合上面的分析，开启端口转发功能时，建议让ssh以后台方式提供端口转发功能，且明确指示不要执行任何ssh命令行上的远程命令。即最佳开启方式为：

		[root@xuexi ~]# ssh -f -N -g -L 22333:host2:22 host3


## 远程端口转发。 

## 动态端口转发。